import React, { useEffect, useState } from 'react'; // Importamos React y hooks
import firebase from './firebase'; // Importamos nuestra configuración de Firebase
import ProductForm from './ProductForm'; // Importamos el componente ProductForm
import ProductList from './ProductList'; // Importamos el componente ProductList

function App() {
    const [products, setProducts] = useState([]); // Estado para almacenar los productos

    useEffect(() => {
        const fetchProducts = async () => {
            const productsCollection = await firebase.firestore().collection('products').get(); // Obtenemos los productos desde Firestore
            
            setProducts(productsCollection.docs.map(doc => ({ id: doc.id, ...doc.data() }))); // Actualizamos el estado con los productos obtenidos
        };
        
        fetchProducts();
    }, []);

    const addProduct = async (productData) => {
        const newProduct = { name: productData.name, price: parseFloat(productData.price) }; // Creamos un nuevo objeto de producto
        
        await firebase.firestore().collection('products').add(newProduct); // Agregamos la nueva tarea a Firestore
        
        setProducts([...products, newProduct]); // Actualizamos el estado local con la nueva tarea
    };

    const deleteProduct = async (id) => {
        await firebase.firestore().collection('products').doc(id).delete(); // Eliminamos al producto de Firestore por su ID
        
        setProducts(products.filter(product => product.id !== id)); // Actualizamos el estado local eliminando el producto eliminado
    };

    return (
        <div className="container mt-5">
            <h1>Gestión de Productos</h1>
            <ProductForm addProduct={addProduct} /> {/* Renderizamos el formulario para agregar productos */}
            <h2>Lista de Productos</h2>
            <ProductList products={products} deleteProduct={deleteProduct} /> {/* Renderizamos la lista de productos */}
        </div>
    );
}

export default App; // Exportamos el componente App para usarlo como entrada principal